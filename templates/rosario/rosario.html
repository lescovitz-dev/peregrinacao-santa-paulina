{% extends "base.html" %}
{% block content %}

<h2>üôè Santo Ros√°rio</h2>
<h3 id="titulo-misterio"></h3>

<div id="contas" class="rosario"></div>

<div id="oracao">
  <h3 id="titulo-oracao"></h3>
  <p id="texto-oracao"></p>
</div>

<div style="margin-top:20px">
  <button onclick="voltar()">Voltar</button>
  <button onclick="avancar()">Avan√ßar</button>
</div>

<script>
/* ======================================================
   ORA√á√ïES FIXAS
====================================================== */
const oracoes = {
  sinalCruz: "‚úùÔ∏è Em nome do Pai, do Filho e do Esp√≠rito Santo. Am√©m.",
  oferecimento: "Divino Jesus, eu vos ofere√ßo este Ter√ßo, que vou rezar, contemplando os mist√©rios de nossa Reden√ß√£o. Concedei-me, pela intercess√£o de Maria, vossa M√£e Sant√≠ssima, a quem me dirijo, as virtudes que me s√£o necess√°rias para bem rez√°-lo e a gra√ßa de ganhar as indulg√™ncias anexas a esta santa devo√ß√£o.",
  credo: "Creio em Deus Pai todo-poderoso, Criador do c√©u e da terra...",
  paiNosso: "Pai Nosso que estais no c√©u...",
  aveMaria: "Ave Maria, cheia de gra√ßa...",
  gloria: "Gl√≥ria ao Pai, ao Filho e ao Esp√≠rito Santo...",
  agradecimento: "Infinitas Gra√ßas vos damos, soberana Rainha, pelos benef√≠cios que todos os dias recebemos de vossas m√£os liberais. Dignai-vos, agora e para sempre, tomarmos debaixo do vosso poderoso amparo. E para mais vos obrigar, vos saudamos com uma Salve Rainha.",
  salveRainha: "Salve Rainha, M√£e de miseric√≥rdia..."
};

/* ======================================================
   MIST√âRIOS (TODOS)
====================================================== */
const misterios = {
  gozosos: [
    { titulo: "A Anuncia√ß√£o", meditacao: "O anjo anuncia a Maria o plano de Deus, e ela responde com f√©." },
    { titulo: "A Visita√ß√£o", meditacao: "Maria visita Isabel, levando Jesus e espalhando alegria." },
    { titulo: "O Nascimento de Jesus", meditacao: "Jesus nasce em Bel√©m, trazendo luz ao mundo." },
    { titulo: "A Apresenta√ß√£o no Templo", meditacao: "Jesus √© apresentado ao Pai no Templo." },
    { titulo: "A Perda e Encontro de Jesus", meditacao: "Jesus √© encontrado no Templo, cuidando das coisas do Pai." }
  ],
  dolorosos: [
    { titulo: "A Agonia no Horto", meditacao: "Jesus aceita a vontade do Pai em meio √† dor." },
    { titulo: "A Flagela√ß√£o", meditacao: "Jesus sofre por nossos pecados." },
    { titulo: "A Coroa√ß√£o de Espinhos", meditacao: "Jesus √© humilhado como Rei." },
    { titulo: "Jesus Carregando a Cruz", meditacao: "Jesus carrega o peso da cruz por amor a n√≥s." },
    { titulo: "A Crucifica√ß√£o", meditacao: "Jesus entrega sua vida para nossa salva√ß√£o." }
  ],
  gloriosos: [
    { titulo: "A Ressurrei√ß√£o", meditacao: "Jesus vence a morte e nos d√° vida nova." },
    { titulo: "A Ascens√£o", meditacao: "Jesus sobe aos c√©us e prepara-nos um lugar." },
    { titulo: "Pentecostes", meditacao: "O Esp√≠rito Santo fortalece a Igreja." },
    { titulo: "A Assun√ß√£o de Maria", meditacao: "Maria √© elevada ao c√©u em corpo e alma." },
    { titulo: "A Coroa√ß√£o de Maria", meditacao: "Maria √© coroada Rainha do C√©u e da Terra." }
  ],
  luminosos: [
    { titulo: "O Batismo de Jesus", meditacao: "Jesus √© revelado como Filho amado do Pai." },
    { titulo: "As Bodas de Can√°", meditacao: "Jesus realiza o primeiro milagre por intercess√£o de Maria." },
    { titulo: "O An√∫ncio do Reino", meditacao: "Jesus chama √† convers√£o." },
    { titulo: "A Transfigura√ß√£o", meditacao: "Jesus revela sua gl√≥ria no Monte Tabor." },
    { titulo: "A Eucaristia", meditacao: "Jesus se entrega como alimento de vida eterna." }
  ]
};

/* ======================================================
   ESCOLHA AUTOM√ÅTICA DO DIA
====================================================== */
const dia = new Date().getDay();
const mapaDia = {
  0: "gloriosos",
  1: "gozosos",
  2: "dolorosos",
  3: "gloriosos",
  4: "luminosos",
  5: "dolorosos",
  6: "gozosos"
};

const tipoMist = mapaDia[dia];
const listaMist = misterios[tipoMist];

/* ======================================================
   ESTADO
====================================================== */
let fase = "inicio"; // inicio | misterios | final
let etapaInicio = 0; // 0 a 7
let etapaFinal = 0;  // 0 a 1
let dezena = 0;
let conta = 0;
let etapa = "meditacao";
let finalizado = false;

/* ======================================================
   RENDER
====================================================== */
function render() {
  const contasDiv = document.getElementById("contas");
  contasDiv.innerHTML = "";

  /* ===== IN√çCIO ===== */
  if (fase === "inicio") {
    document.getElementById("titulo-misterio").innerText = "Prepara√ß√£o do Ros√°rio";

    const etapasInicio = [
      { tipo: "cruz", titulo: "Sinal da Cruz", texto: oracoes.sinalCruz },
      { tipo: "texto", titulo: "Oferecimento do Ros√°rio", texto: oracoes.oferecimento },
      { tipo: "texto", titulo: "Credo", texto: oracoes.credo },
      { tipo: "grande", titulo: "Pai Nosso", texto: oracoes.paiNosso },
      { tipo: "pequena", titulo: "Ave Maria", texto: oracoes.aveMaria },
      { tipo: "pequena", titulo: "Ave Maria", texto: oracoes.aveMaria },
      { tipo: "pequena", titulo: "Ave Maria", texto: oracoes.aveMaria },
      { tipo: "grande", titulo: "Gl√≥ria", texto: oracoes.gloria }
    ];

    etapasInicio.forEach((e, i) => {
      if (e.tipo === "cruz") {
        contasDiv.innerHTML += `<span class="cruz">‚úùÔ∏è</span>`;
      } else if (e.tipo !== "texto") {
        contasDiv.innerHTML += `<span class="conta ${e.tipo} ${i === etapaInicio ? 'ativa' : ''}"></span>`;
      }
    });

    document.getElementById("titulo-oracao").innerText = etapasInicio[etapaInicio].titulo;
    document.getElementById("texto-oracao").innerText = etapasInicio[etapaInicio].texto;
    return;
  }

  /* ===== FINAL ===== */
  if (fase === "final") {
    const finais = [
      { titulo: "Ora√ß√£o de Agradecimento", texto: oracoes.agradecimento },
      { titulo: "Salve Rainha", texto: oracoes.salveRainha }
    ];
    document.getElementById("titulo-misterio").innerText = "Encerramento";
    document.getElementById("titulo-oracao").innerText = finais[etapaFinal].titulo;
    document.getElementById("texto-oracao").innerText = finais[etapaFinal].texto;
    return;
  }

  /* ===== MIST√âRIOS ===== */
  const mist = listaMist[dezena];
  document.getElementById("titulo-misterio").innerText =
    `${dezena + 1}¬∫ Mist√©rio (${tipoMist.charAt(0).toUpperCase() + tipoMist.slice(1)})`;

  if (etapa === "meditacao") {
    document.getElementById("titulo-oracao").innerText = mist.titulo;
    document.getElementById("texto-oracao").innerText = mist.meditacao;
    return;
  }

  contasDiv.innerHTML += `<span class="conta grande ${conta === 0 ? 'ativa' : ''}"></span>`;
  for (let i = 1; i <= 10; i++) {
    contasDiv.innerHTML += `<span class="conta pequena ${conta === i ? 'ativa' : ''}"></span>`;
  }

  if (etapa === "gloria") {
    document.getElementById("titulo-oracao").innerText = "Gl√≥ria";
    document.getElementById("texto-oracao").innerText = oracoes.gloria;
  } else {
    document.getElementById("titulo-oracao").innerText = conta === 0 ? "Pai Nosso" : "Ave Maria";
    document.getElementById("texto-oracao").innerText = conta === 0 ? oracoes.paiNosso : oracoes.aveMaria;
  }
}

/* ======================================================
   AVAN√áAR
====================================================== */
function avancar() {
  if (finalizado) return;

  if (fase === "inicio") {
    etapaInicio++;
    if (etapaInicio > 7) {
      fase = "misterios";
      etapa = "meditacao";
    }
    render();
    return;
  }

  if (fase === "final") {
    etapaFinal++;
    if (etapaFinal > 1) finalizado = true;
    render();
    return;
  }

  if (etapa === "meditacao") {
    etapa = "paiNosso";
    conta = 0;
    render();
    return;
  }

  if (etapa === "gloria") {
    dezena++;
    if (dezena === 5) {
      fase = "final";
      etapaFinal = 0;
    } else {
      etapa = "meditacao";
      conta = 0;
    }
    render();
    return;
  }

  if (conta < 10) conta++;
  else etapa = "gloria";

  render();
}

/* ======================================================
   VOLTAR
====================================================== */
function voltar() {
  if (fase === "inicio") {
    if (etapaInicio > 0) etapaInicio--;
    render();
    return;
  }

  if (fase === "final") {
    if (etapaFinal > 0) etapaFinal--;
    else {
      fase = "misterios";
      dezena = 4;
      etapa = "gloria";
    }
    render();
    return;
  }

  if (etapa === "meditacao" && dezena > 0) {
    dezena--;
    etapa = "gloria";
    conta = 10;
    render();
    return;
  }

  if (etapa === "gloria") {
    etapa = "aveMaria";
    conta = 10;
  } else if (conta > 0) {
    conta--;
  }

  render();
}

render();
</script>

{% endblock %}